// ShopifyStore.js
//
// Copyright 2012 Shopify, Inc.
//
// detect IE version
function log(a){window.console&&window.console.log&&console.log(a)}function needsPolling(){if(navigator.appName!="Microsoft Internet Explorer")return!1;var a=navigator.userAgent,b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){var c=parseFloat(RegExp.$1);return c<8}}function isSafari(){return navigator.vendor&&navigator.vendor.match(/Apple/)&&navigator.userAgent.match(/Safari/)}var ie=function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");while(c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->",d[0]);return b>4?b:a}(),ShopifyStore={lasthash:"",defaultStylesheet:'  @-webkit-keyframes fade {    0% { opacity:0;}    100% { opacity:1;}  }  #shopifystore-cookie { position:absolute;left:-10000px;width:1px;height:1px}   #shopifystore-overlay { width: 100%; height: 100%; position: fixed; left: 0; top: 0; bottom: 0; right: 0; z-index:99998;    background: rgba(0,0,0,.2) url("http://widgets.shopifyapps.com/assets/bg-overlay.png") repeat;    -webkit-box-shadow: inset 0 0 1200px 20px rgba(0,0,0,.25);    -moz-box-shadow: inset 0 0 1200px 20px rgba(0,0,0,.25);    box-shadow: inset 0 0 1200px 20px rgba(0,0,0,.25);    -webkit-animation: fade .4s 1;    -webkit-animation-direction: alternate;    -moz-animation:fade .4s 1;    -moz-animation-direction:alternate;    animation: fade .4s 1;    animation-direction:alternate;  }  #shopifystore-loading { width: 100%; height: 100%; position: fixed; left: 0; top: 0; bottom: 0; right: 0; z-index:99999;    background:url("http://widgets.shopifyapps.com/assets/loading-store.gif") no-repeat center center;    -webkit-animation: fade .4s 1;    -webkit-animation-direction: alternate;    -moz-animation:fade .4s 1;    -moz-animation-direction:alternate;    animation: fade .4s 1;    animation-direction:alternate;    }  #shopifystore-close { position: fixed; left:50%; top:50%; margin-left: 455px; margin-top:-300px; width: 30px; height:30px;     background: transparent url("http://widgets.shopifyapps.com/assets/store_close.png"); z-index:100001; cursor:pointer;}   #shopifystore { z-index:100000; position:fixed; left: 50%; margin-left: -480px; top: 50%; margin-top: -300px; background: transparent;}',ieStylesheet:'  #shopifystore-overlay { background: url("http://widgets.shopifyapps.com/assets/bg-overlay.png") repeat;}',init:function(a,b){this.shop=b.shop,this.collections=b.collections,this.referer=window.location.href,this.url=a+"?shop="+this.shop+"&referer="+escape(this.referer),this.bodyEl=document.getElementsByTagName("body")[0],this.overlayEl=this._buildOverlayEl(),this.loadingEl=this._buildLoadingEl(),this.storeEl=this._buildStoreEl(),this.closeEl=this._buildCloseEl(),this._insertStyleSheet(),this._initListeners(),this.handleChange()},open:function(a){var b=this.url;a&&(b+="&"+a),b+="&ids="+this.collections,!this.storeEl.getAttribute("src")!==b&&this.storeEl.setAttribute("src",b),this.storeEl.style.display="",this.overlayEl.style.display="",this.loadingEl.style.display="",this.closeId=setTimeout(function(){document.getElementById("shopifystore-close").style.display=""},2e3)},close:function(){window.location.hash="",ShopifyStore.storeEl.style.display="none",ShopifyStore.storeEl.setAttribute("src",""),ShopifyStore.overlayEl.style.display="none",ShopifyStore.loadingEl.style.display="none",ShopifyStore.closeEl.style.display="none"},closeKeyHandler:function(a){a.keyCode&&a.keyCode==27&&ShopifyStore.close()},handleChange:function(a){var b=window.location.hash,c=b.split("?");if(c[0]!=="#shopify-store")return;c.length>1?ShopifyStore.open(c[1]):ShopifyStore.open()},_initListeners:function(){"onhashchange"in window&&!needsPolling()?window.addEventListener?window.addEventListener("hashchange",ShopifyStore.handleChange,!1):window.attachEvent?window.attachEvent("onhashchange",ShopifyStore.handleChange):window.addEvent("onhashchange",ShopifyStore.handleChange):this.hashWatcher(ShopifyStore.handleChange),window.addEventListener?(document.addEventListener("keyup",ShopifyStore.closeKeyHandler,!1),this.overlayEl.addEventListener("click",ShopifyStore.close,!1)):window.attachEvent?(document.attachEvent("onkeyup",ShopifyStore.closeKeyHandler,!1),this.overlayEl.attachEvent("onclick",ShopifyStore.close,!1)):(document.addEvent("onkeyup",ShopifyStore.closeKeyHandler),this.overlayEl.addEvent("click",ShopifyStore.close,!1))},_buildOverlayEl:function(){var a=document.createElement("div");return a.setAttribute("id","shopifystore-overlay"),a.style.display="none",this.bodyEl.appendChild(a),a},_buildLoadingEl:function(){var a=document.createElement("div");return a.setAttribute("id","shopifystore-loading"),a.style.display="none",this.bodyEl.appendChild(a),a},_buildStoreEl:function(){var a=document.createElement("iframe");return a.setAttribute("width","960px"),a.setAttribute("height","630px"),a.setAttribute("frameborder","0"),a.setAttribute("scrolling","no"),a.setAttribute("id","shopifystore"),a.setAttribute("allowtransparency","true"),a.setAttribute("frameBorder","0"),a.style.display="none",this.bodyEl.appendChild(a),a},_buildCloseEl:function(){var a=document.createElement("div");return a.setAttribute("id","shopifystore-close"),a.style.display="none",a.onclick=ShopifyStore.close,this.bodyEl.appendChild(a),a},_insertStyleSheet:function(){var a=document.createElement("style"),b=document.getElementsByTagName("title")[0];b.parentNode.insertBefore(a,b);try{a.innerHTML=this.defaultStylesheet}catch(c){a.styleSheet.cssText=this.defaultStylesheet,ie&&(a.styleSheet.cssText+=this.ieStylesheet)}},hashWatcher:function(){var a=window.location.hash;a!==ShopifyStore.lasthash&&(ShopifyStore.handleChange(),ShopifyStore.lasthash=a),setTimeout(ShopifyStore.hashWatcher,100)}};(function(){function a(){ShopifyStore.init(b,ShopifyStoreConfig)}var b="http://widgets.shopifyapps.com/shop";window.attachEvent?window.attachEvent("onload",a):window.addEventListener("load",a,!1)})();